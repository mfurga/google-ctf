# Crypto Caulingo (crypto)

Well you've done it, you're now an admin of the Cookie World Order. The clandestine organisation that seeks to control the world through a series of artfully placed tasty treats, bringing folks back in to their idea of what a utopian society would look like. Strangely enough, the webcam data is being fed to understand the properties of the entities you had originally seen. They seem to be speaking back into the camera (an unadvertised microphone) but it's hard to understand what they want. You must- if nothing else ever was important in your life, you must make contact with these beautiful creatures! Also, what exactly is a "cauliflower"?

Attachment: [3d0b47fb89e15f694d2e48117886cf60cfdf4e3a554538a4e92771d551be2ab0](https://storage.googleapis.com/gctf-2019-attachments/3d0b47fb89e15f694d2e48117886cf60cfdf4e3a554538a4e92771d551be2ab0)


### Solution

(...) Finally in year 1997, neurosurgeon Louis Walker discover the key generation algorithm
of the cauliflowers while dissecting one. It is indeed very similar to a normal RSA key
generation algorithm, except for the fact that they always try to satisfy one constraint
when choosing their P and Qs. That is,

<p align="center">
<img src="https://latex.codecogs.com/svg.latex?\Large&space;A*P\approx%20B*Q">
</p>

to be precise, the difference between A × P and B × Q is less than 10000, where

<p align="center">
<img src="https://latex.codecogs.com/svg.latex?\Large&space;1\leq%20A,%20B\leq1000" >
</p>

That’s a huge breakthrough! At least we are proud to say that we did not waste that
thousands of years of taxpayers’ money.

```bash
> cat msg.txt
n:
17450892350509567071590987572582143158927907441748820483575144211411640241849663641180283816984167447652133133054833591585389505754635416604577584488321462013117163124742030681698693455489404696371546386866372290759608301392572928615767980244699473803730080008332364994345680261823712464595329369719516212105135055607592676087287980208987076052877442747436020751549591608244950255761481664468992126299001817410516694015560044888704699389291971764957871922598761298482950811618390145762835363357354812871474680543182075024126064364949000115542650091904557502192704672930197172086048687333172564520657739528469975770627

e:
65537

msg:
50fb0b3f17315f7dfa25378fa0b06c8d955fad0493365669bbaa524688128ee9099ab713a3369a5844bdd99a5db98f333ef55159d3025630c869216889be03120e3a4bd6553d7111c089220086092bcffc5e42f1004f9888f25892a7ca007e8ac6de9463da46f71af4c8a8f806bee92bf79a8121a7a34c3d564ac7f11b224dc090d97fdb427c10867ad177ec35525b513e40bef3b2ba3e6c97cb31d4fe3a6231fdb15643b84a1ce704838d8b99e5b0737e1fd30a9cc51786dcac07dcb9c0161fc754cda5380fdf3147eb4fbe49bc9821a0bcad98d6df9fbdf63cf7d7a5e4f6cbea4b683dfa965d0bd51f792047e393ddd7b7d99931c3ed1d033cebc91968d43f
```

So I hope it's clear to everyone that we have the RSA algorithm in this task.

<p align="center">
<img src="https://latex.codecogs.com/svg.latex?\Large&space;A*P\approx%20B*Q\Leftrightarrow%20P\approx%20%7B%7BB*Q%7D\over%20A%7D\Leftrightarrow%20P^2\approx%20%7B%7BB*P*Q%7D\over%20A%7D=%7B%7BB*N%7D\over%20A%7D">
<br>
<img src="https://latex.codecogs.com/svg.latex?\Large&space;P%5Capprox%20%5Csqrt%7B%7BB*N%7D%5Cover%20A%7D">
</p>

We can obviously try to brute force it (1 <= A, B <= 1000). The easiest way to do that is to use Python because it has a built-in bignum implementation.

```python
#!/usr/bin/env python2

from gmpy2 import isqrt

N = 17450892350509567071590987572582143158927907441748820483575144211411640241849663641180283816984167447652133133054833591585389505754635416604577584488321462013117163124742030681698693455489404696371546386866372290759608301392572928615767980244699473803730080008332364994345680261823712464595329369719516212105135055607592676087287980208987076052877442747436020751549591608244950255761481664468992126299001817410516694015560044888704699389291971764957871922598761298482950811618390145762835363357354812871474680543182075024126064364949000115542650091904557502192704672930197172086048687333172564520657739528469975770627

def solve():
  # 1 <= A, B <= 1000
  for A in xrange(1000, 0, -1):
    for B in xrange(1000, 0, -1):
      P = isqrt(N * B / A)

      for e in range(-10, 11):
        p = P + e
        if N % p == 0:
          print 'P=%i' % p
          print 'Q=%i' % (N / p)
          return
```

After a few seconds we've got the prime numbers P and Q. Now we're going to decrypt the message.

```python
#!/usr/bin/env python2
n = 17450892350509567071590987572582143158927907441748820483575144211411640241849663641180283816984167447652133133054833591585389505754635416604577584488321462013117163124742030681698693455489404696371546386866372290759608301392572928615767980244699473803730080008332364994345680261823712464595329369719516212105135055607592676087287980208987076052877442747436020751549591608244950255761481664468992126299001817410516694015560044888704699389291971764957871922598761298482950811618390145762835363357354812871474680543182075024126064364949000115542650091904557502192704672930197172086048687333172564520657739528469975770627
e = 65537
m = 0x50fb0b3f17315f7dfa25378fa0b06c8d955fad0493365669bbaa524688128ee9099ab713a3369a5844bdd99a5db98f333ef55159d3025630c869216889be03120e3a4bd6553d7111c089220086092bcffc5e42f1004f9888f25892a7ca007e8ac6de9463da46f71af4c8a8f806bee92bf79a8121a7a34c3d564ac7f11b224dc090d97fdb427c10867ad177ec35525b513e40bef3b2ba3e6c97cb31d4fe3a6231fdb15643b84a1ce704838d8b99e5b0737e1fd30a9cc51786dcac07dcb9c0161fc754cda5380fdf3147eb4fbe49bc9821a0bcad98d6df9fbdf63cf7d7a5e4f6cbea4b683dfa965d0bd51f792047e393ddd7b7d99931c3ed1d033cebc91968d43f
p = 151086174643947302290817794140091756798645765602409645643205831091644137498519425104335688550286307690830177161800083588667379385673705979813357923016141205953591742544325170678167010991535747769057335224460619777264606691069942245683132083955765987513089646708001710658474178826337742596489996782669571549253
q = 115502906812186413716028212900548735990904256575141882752425616464266991765240920703188618324966988373216520827723741484031611192826120314542453727041306942082909556327966471790487878679927202639569020757238786152140574636623998668929044300958627146625246115304479897191050159379832505990011874114710868929959


def egcd(a, b):
  """Extended Euclidean algorithm.
  Return (g, x, y) such that a*x + b*y = g = gcd(a, b).
  """
  if a == 0:
    return (b, 0, 1)
  else:
    g, x, y = egcd(b % a, a)
    return (g, y - (b // a) * x, x)

phi = (p - 1) * (q - 1)
d = egcd(e, phi)[1] % phi
print hex(pow(m, d, n))[2:-1].decode('hex')
```

```bash
> python solver.py
Hey there!

If you are able to decrypt this message, you must a life form with high intelligence!

Therefore, we would like to invite you to our dancing party!

Here’s your invitation code: CTF{017d72f0b513e89830bccf5a36306ad944085a47}
```


**FLAG: CTF{017d72f0b513e89830bccf5a36306ad944085a47}**